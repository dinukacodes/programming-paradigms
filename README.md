# FormLang++ Project Documentation

This document provides an overview of the directory structure, purpose of each file and directory within the `FormLang` project directory (excluding `examples` and `output`), and a brief explanation of the code in the source files.

## Directory Structure

```
FormLang/
├── bin/                  # Compiled executable
├── codefetch/            # Related to codebase documentation (contains codebase.md)
├── docs/                 # Documentation files
├── obj/                  # Object files generated during compilation
├── src/                  # Source code and build files
├── progress.md           # Project progress tracking
├── testing.md            # Placeholder or temporary testing file
```

## Directory and File Descriptions

### FormLang/

The root directory of the FormLang++ project, containing all source files, build artifacts, and documentation.

### FormLang/bin/

This directory contains the final compiled executable of the FormLang++ compiler, named `formLang`.

### FormLang/codefetch/

This directory contains files potentially related to documenting or fetching parts of the codebase. It currently contains `codebase.md`.

### FormLang/docs/

This directory holds documentation related to the FormLang++ language and project.

*   **grammar.md**: Likely contains a detailed specification of the FormLang++ grammar, possibly in EBNF format.
*   **syntax.md**: Likely describes the syntax rules of the FormLang++ language.

### FormLang/obj/

This directory stores the intermediate object files (`.o` files) generated during the compilation process by the C compiler (`gcc`).

*   **html_generator.o**: Object file compiled from `html_generator.c`.
*   **lex.yy.o**: Object file compiled from `lex.yy.c` (generated by Flex).
*   **parser.tab.o**: Object file compiled from `y.tab.c` (generated by Bison).

### FormLang/src/

This directory contains the core source code files for the FormLang++ compiler, the build configuration, and generated files from the build process.

*   **lexer.l**: (Flex Input) Defines the lexical rules (tokens) of the FormLang++ language. It includes C code for handling string escapes and error reporting. It defines rules for keywords (`form`, `section`, `field`, etc.), identifiers, literals (numbers, strings), operators, and punctuation.

    ```c
    %{
    // Includes for standard libraries and project header
    // External declaration for yylval (Bison's semantic value union)
    // Context tracking (e.g., `after_colon`)
    // Error handling function `syntax_error`
    // Helper function `process_string` to handle escape sequences in strings
    %}

    %option ... // Flex options (nounput, noinput, yylineno, noyywrap)

    %%

    // Rules for skipping whitespace and newlines
    // Rules for matching keywords and returning corresponding tokens
    // Rules for matching operators and punctuation
    // Rules for matching field types (conditional based on `after_colon`)
    // Rules for matching attributes
    // Rules for matching specialized registration/address fields
    // Rule for matching general identifiers
    // Rule for matching integer literals
    // Rule for matching string literals (calls `process_string`)
    // Fallback rule for unexpected characters

    %%

    // yywrap function (required by Flex)
    ```

*   **parser.y**: (Bison Input) Defines the grammatical rules (syntax) of the FormLang++ language and actions to build the Abstract Syntax Tree (AST) and perform semantic checks. It includes C code for AST node creation, adding elements to the form/sections, handling metadata, and managing field names to check for duplicates.

    ```c
    %{
    // Includes for standard libraries and project header
    // External declarations for yylex, yylineno, yyerror, yyin
    // Global variables for current form and section being parsed
    // Data structure and functions for tracking field names (for duplicate checks)
    // Helper functions for creating form, section, field nodes
    // Functions for adding sections, fields, metadata to the AST
    // Function to initialize field attributes
    // Function to check for duplicate field names
    // Function to merge field attributes
    // Cleanup functions for freeing allocated memory (form, metadata)
    %}

    %token ... // Token declarations (from lexer)
    %union { ... } // Bison's semantic value union
    %type <...> ... // Type declarations for grammar rules
    %define parse.error verbose // Enable verbose error reporting

    %%

    // Grammar rules for the FormLang++ structure:
    // form: Defines the top-level form structure.
    // form_body: Contains sections, validation blocks, and metadata.
    // form_item: Represents a single item in the form body.
    // section_list: List of sections.
    // section: Defines a section with an identifier and a list of fields.
    // section_header: Rule specifically for parsing the section header.
    // field_list: List of field declarations within a section.
    // field_declaration: Defines a field with an identifier, type, and attributes.
    // field_type: Defines the possible types for a field.
    // field_attributes: List of attributes for a field.
    // attribute_opt_semicolon: Allows attributes with or without a trailing semicolon.
    // attribute: Defines individual field attributes and their associated values.
    // validation_blocks: List of validation blocks.
    // validation_block: Defines a block containing validation rules.
    // validation_rules: List of individual validation rules.
    // validation_rule: Defines a single validation rule with a condition and error message.
    // condition: Defines the structure of conditional expressions used in validation rules.
    // metadata_declaration: Defines the structure for declaring metadata.

    %%

    // yyerror function (Bison's error reporting function)
    // main function: Entry point, handles file input, calls yyparse, generates HTML, and cleans up.
    // yywrap function (required by Flex/Bison when not using %option noyywrap)
    ```

*   **formLang.h**: (Header File) A common header file included by the lexer, parser, and HTML generator. It defines the data structures used to represent the parsed FormLang++ code (AST nodes) and declares function prototypes for functions shared across the different components.

    ```c
    #ifndef FORMLANG_H
    #define FORMLANG_H

    // Includes for standard libraries

    // Metadata structure definition
    // ValidationRule structure definition
    // FieldType enum definition
    // AddressField structure definition (for address subfields)
    // FieldAttributes structure definition
    // Field structure definition
    // Section structure definition
    // Form structure definition

    // External declarations for global variables and Flex/Bison functions

    // Function declarations for HTML generation functions
    // Function declarations for validation JavaScript generation
    // Function declarations for metadata handling
    // Function declarations for AST node creation and manipulation
    // Function declaration for cleanup

    #endif /* FORMLANG_H */
    ```

*   **html_generator.c**: (C Source) Contains functions to traverse the Abstract Syntax Tree (AST) built by the parser and generate the corresponding HTML form and client-side validation JavaScript. It includes functions for generating the HTML document structure, styling, form elements based on field types and attributes, and a script for basic client-side validation.

    ```c
    #include ... // Includes for standard libraries and project header

    // Function to generate HTML header (doctype, html, head, meta, title, style)
    // Includes metadata as HTML comments
    // Adds basic CSS styling
    // Starts the <form> tag with an id and onsubmit handler

    // Function to generate HTML footer (closing body and html tags)

    // Helper function to escape HTML attributes

    // Function to generate HTML for a section (<section>, <h2>)
    // Iterates through fields in the section and calls appropriate generation logic

    // Logic within generate_section_html for different field types:
    // Generates <label> tags
    // Handles <textarea> with rows/cols attributes
    // Handles <select> (dropdown) with options and default value
    // Handles radio buttons with a group div
    // Handles address fields with multiple input fields
    // Handles other input types (<input type="...">) with attributes (required, minlength, maxlength, min, max, pattern, value, checked, accept, data-confirm, data-strength)
    // Adds <meter> for password strength if required

    // Static helper function parse_condition to extract field, operator, and value from a condition string

    // Function to generate client-side validation JavaScript
    // Adds a DOMContentLoaded listener
    // Adds a submit event listener to the form
    // Iterates through validation rules from the AST
    // Generates JavaScript to get field values and evaluate conditions
    // Pushes error messages to an array if conditions are met
    // Prevents form submission and shows an alert with errors if not valid

    // Main function generate_html: Orchestrates the HTML generation process
    // Calls generate_html_header, generates sections, adds submit button, calls generate_html_footer, and calls generate_validation_js.
    ```

*   **Makefile**: (Build File) Configures and automates the build process for the FormLang++ compiler. It uses Flex (`flex`) and Bison (`bison`) to generate C code from `.l` and `.y` files, and then uses GCC (`gcc`) to compile the C files and link them into the final executable.

    ```makefile
    CC = gcc          # C Compiler
    CFLAGS = -Wall -g # Compiler flags (warnings, debug info)
    FLEX = flex       # Flex executable
    BISON = bison     # Bison executable

    TARGET = formLang # Name of the final executable

    # Source files for Flex, Bison, and C
    LEX_SRC = lexer.l
    YACC_SRC = parser.y
    C_SRC = html_generator.c

    # Generated C files from Flex and Bison
    LEX_C = lex.yy.c
    YACC_C = y.tab.c
    YACC_H = y.tab.h

    # Object files compiled from generated and source C files
    OBJS = $(LEX_C:.c=.o) $(YACC_C:.c=.o) $(C_SRC:.c=.o)

    # Default target: builds the target executable
    all: $(TARGET)

    # Rule to link object files and generated C files into the target executable
    $(TARGET): $(LEX_C) $(YACC_C) $(C_SRC)
    	$(CC) $(CFLAGS) -o $@ $^ -lfl # Link with the Flex library (-lfl)

    # Rule to generate parser C code (.tab.c, .tab.h) from the Bison source (.y)
    $(YACC_C) $(YACC_H): $(YACC_SRC)
    	$(BISON) -d -y $<

    # Rule to generate lexer C code (.yy.c) from the Flex source (.l)
    $(LEX_C): $(LEX_SRC) $(YACC_H)
    	$(FLEX) $<

    # Rule to clean up generated files and object files
    clean:
    	rm -f $(TARGET) $(LEX_C) $(YACC_C) $(YACC_H) *.o

    # Phony targets to prevent conflicts with files of the same name
    .PHONY: all clean
    ```

*   **lex.yy.c**: (Generated C) This file is automatically generated by the `flex` tool from `lexer.l`. It contains the C code for the lexical analyzer (lexer), which reads the input `.form` file and converts the character stream into a sequence of tokens.

*   **y.tab.c**: (Generated C) This file is automatically generated by the `bison` tool from `parser.y`. It contains the C code for the parser, which takes the tokens from the lexer and checks if they conform to the grammar rules defined in `parser.y`. It also executes the semantic actions defined in `parser.y` to build the AST.

*   **y.tab.h**: (Generated Header) This file is automatically generated by the `bison` tool from `parser.y`. It contains the definitions for the token types used by the lexer and parser, as well as the definition of the `YYSTYPE` union, which holds the semantic values associated with tokens and grammar rules.

*   **parser.tab.c**, **parser.tab.h**, **parser.output**: These are additional files that can be generated by Bison depending on the command-line options used in the Makefile (e.g., `-d`, `-v`). `parser.output` provides a detailed description of the parser's states and any grammar conflicts found.

*   **debug.log**: This file appears to be a simple log file, likely used for debugging output during the development or execution of the compiler.

### FormLang/progress.md

A markdown file used to track the development progress of the FormLang++ project, likely outlining completed and upcoming tasks based on the project plan.

### FormLang/testing.md

An empty markdown file. Its purpose is not immediately clear from the contents, but it might be a placeholder for testing notes or a temporary file. 